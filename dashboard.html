<!DOCTYPE html>
<html lang="en">
<link rel="shortcut icon" href="./assets/img/logo.png" />
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>UpFinity - World's Most Innovative Token</title>
  <meta name="description" content="UpFinity(UPF) is the World's Most Innovative Token with 23+ Fully New Unique Features">
  <meta name="og:title" content="UpFinity(UPF) is the World's Most Innovative Token with 23+ Fully New Unique Features">
  <meta name="twitter:title" content="UpFinity(UPF) is the World's Most Innovative Token with 23+ Fully New Unique Features">
  <meta name="keywords" content="UpFinity,UPF,bitcoin,dogecoin,doge,defi,coinbase,coinmarketcap,coinmarket,bscscan,whitebit,coingecko,cryptocurrency,crypto,pancakeswap,dex,ethereum,eth,btc">
  <meta name="og:image" content="{% static 'assets/img/logo.png' %}" />
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="{% static 'assets/img/logo.png' %}" />
  <meta name="twitter:title" content="UpFinity Coin Vote Site">
  
  <meta content="UpFinity,UPF,bitcoin,dogecoin,doge,defi,coinbase,coinmarketcap,coinmarket,bscscan,whitebit,coingecko,cryptocurrency,crypto,pancakeswap,dex,ethereum,eth,btc" name="keywords">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <!-- blockchains -->
  <script src="assets/js/web3.min.js" type="text/javascript" ></script>
  <script src="https://unpkg.com/@metamask/detect-provider/dist/detect-provider.min.js"></script>
  <script src="assets/js/ethers.umd.min.js" type="application/javascript"></script>
  
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="shortcut icon">
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto|Oswald:300,400,700|Teko:400,600" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Vendor CSS Files -->
  <!-- <link rel="stylesheet" href="assets/css/theme.min.css"> -->
  <!-- <link rel="stylesheet" href="assets/css/materialize.min.css"> -->
  
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/font-awesome/css/fontawesome-all.min.css" rel="stylesheet">
  
  
  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">
 
            
  <!-- =======================================================
  * Template Name: MyResume - v4.5.0
  * Template URL: https://bootstrapmade.com/free-html-bootstrap-template-my-resume/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <!-- <button type="button" class="mobile-nav-toggle d-xl-none"><i class="bi bi-list mobile-nav-toggle"></i></button> -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>
  <!-- ======= Header ======= -->
  <header id="header" class="d-flex flex-column justify-content-center">
  </header><!-- End Header -->
  
  <main id="main">
        
<!-- ======= About Section ======= -->
    <section id="Status" class="about">
      <div class="container" data-aos="fade-up">

        <div class="section-title">
          <img src="assets/img/whale.gif">
          <h2>Status</h2>
          <div class="text-center" style="margin-top:25px;">
              <a href="#null" id="connect" class="button scrollto" onclick="fconnect();">Connect Wallet</a>
              <div id="connectResult"><span><span></div>
          </div>
          
        </div>

        <div class="row">
          <div class="col-12 col-lg-6 text-justify content">
            <h3>Sell Rules</h3>
            <div class="accordion-body">
              <p><strong>Investors should be protected</strong></p>
              
              <h4>Global Anti-Dump Algorithm</h4>
              <div>When current price drops by <span id="_curcuitBreakerThreshold">15</span>% within <span id="_accuTaxTimeWindow"></span> day, triggers [Circuit breaker]</div>
              
              <h4>Circuit Breaker Algorithm</h4>
              <div>None can sell for <span id="_curcuitBreakerDuration"></span> hours, resets [Global Anti-dump algorithm]</div>
              
              <h4>Personal Anti-Dump Algorithm</h4>
              <div>Each wallet can only sell/transfer <span id="_taxAccuTaxThreshold"></span>% of price impact within 1 day</div>
              
              <h4>Global Anti-Panic Algorithm</h4>
              <div>Only 1 sell per <span id="_antiDumpDuration"></span> min can happen, globally.</div>
              
              <h4>Personal Anti-Panic Algorithm</h4>
              <div>Each wallet can sell once every <span id="_buySellTimeDuration"></span> min</div>
              
              
            </div>
          </div>
          <div class="col-12 col-lg-6 text-justify content">
            <div class="row mt-5">
              <span id="devNotice"></span>
            </div>
            <div class="row mt-5">
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Limit Per 1 Buy</h5>
                    <h6 class="text-center ">(<10% Liq)</h6>
                    <div id="oneBuyLimitStatus" class="text-center"></div>
                    
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Balance</h5>
                    <h6 class="text-center ">(<span id="_maxBalanceNume">1.1</span>% Max)</h6>
                    <div id="balanceStatus" class="text-center"></div>
                    <div id="balancePercentageStatus" class="text-center"></div>
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Grade</h5>
                    <div id="balanceIcon" style="font-size: 100px;"></div>
                </div>
              </div>
            
            
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Limit Per 1 Sell</h5>
                    <h6 class="text-center ">(<1.5% Impact)</h6>
                    <div id="oneSellLimitStatus" class="text-center"></div>
                    
                </div>
              </div>
             <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Sell Cooltime</h5>
                    <div id="sellCooltime" class="text-center"></div>
                    
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Can't Sell because</h5>
                    <div id="circuitBreakerStatus" class="text-center"></div>
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Tax Penalty</h5>
                    <div>+<span id="yourTaxPenalty"></span>%</div>
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h5 class="text-center ">Dividend Party</h5>
                    <div id="dividendPartyStatus"></div>
                    <div>+<span id="dividendPartyImpactMin"></span>% ~ +<span id="dividendPartyImpactMax"></span>%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="section-title">
          <h2>Stats</h2>
          <p>Check realtime basic stats!<p>
          <div class="text-center" style="margin-top:25px;">
             <a href="#null" id="connect" class="button scrollto" onclick="fconnect();">Connect Wallet</a>
            <div id="connectResult"><span><span></div>
          </div>
        </div>
        <div class="container aos-init aos-animate" data-aos="fade-up">

          <div class="row gy-4">

            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span id="priceCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-decimals="10" data-purecounter-currency="true" data-purecounter-currencysymbol="$" class="purecounter"></span>
                  <p>Price</p>
                </div>
              </div>
            </div>

            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span id="burnCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" data-purecounter-currency="true" class="purecounter"></span>
                  <p>Burned</p>
                </div>
              </div>
            </div>

            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span id="circulateCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" data-purecounter-currency="true" class="purecounter"></span>
                  <p>Circulating</p>
                </div>
              </div>
            </div>

            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span>$</span><span id="marketcapCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" class="purecounter"></span>
                  <p>Market Cap</p>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span id="manualBurnCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" class="purecounter"></span><span>%</span>
                  <p>Burned by Event</p>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span id="manualLPBurnCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" class="purecounter"></span><span>%</span>
                  <p>LP Burned by Event</p>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span>$</span><span id="initialMcapCounter" data-purecounter-start="0" data-purecounter-end="333" data-purecounter-duration="5" data-purecounter-separator="true" class="purecounter"></span>
                  <p>Initial Market Cap</p>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-2">
              <div class="count-box">
                <div>
                  <span>x</span><span id="startMultiCounter" data-purecounter-start="0" data-purecounter-end="0" data-purecounter-duration="5" data-purecounter-separator="true" class="purecounter"></span>
                  <p>Multiplied from start</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section><!-- End About Section -->

   
    <!-- ======= About Section ======= -->
    <section id="Rewards" class="about">
      <div class="container" data-aos="fade-up">

        <div class="section-title">
          <h2>Rewards</h2>
          
            <div class="text-center" style="margin-top:25px;">
                <a href="#null" id="connect" class="button scrollto" onclick="fconnect();">Connect Wallet</a>
                <div id="connectResult"><span><span></div>
            </div>
        </div>

        <div class="row">
          <div class="col-12 col-lg-6 text-justify content">
            <h3>How to use</h3>
            <ul>
                <li><i class="bi bi-chevron-right"></i> Connect your wallet to view the rewards.</li>
                <li><i class="bi bi-chevron-right"></i> Click Claim button to claim your rewards</li>
            </ul>
          </div>
          <div class="col-12 col-lg-6 pt-4 pt-lg-0 content">
            <div class="row mt-5">
              <span id="devNotice"></span>
            </div>
            <div class="row mt-5">
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h6 class="text-center ">Total rewards left</h6>
                    <div id="totalUnclaimed" class="text-center">BNB</div>
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                <div class="icon-box">
                    <h6 class="text-center ">You can claim</h6>
                    <div id="claimable" class="text-center">
                        BNB<br>
                    </div>
                    <a href="#null" id="claim" class="button scrollto" onclick="fclaim();">Claim</a>
                </div>
              </div>
              <div class="col-6 col-md-4 d-flex align-items-stretch" data-aos="zoom-in" data-aos-delay="100">
                  <div class="icon-box">
                      <h6 class="text-center ">Your claimed rewards</h6>
                      <div id="claimed" class="text-center">
                          BNB
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section><!-- End About Section -->
    

  </main><!-- End #main -->

  
  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <h3>UpFinity</h3>
      <p>Buy, Hold, Earn: World's Best Innovative, Upgradable Token</p>
      <div class="social-links">
        <a href="https://t.me/UpFinityTG" target="_tab" class="telegram"><i class="bi bi-telegram"></i></a>
        <a href="https://twitter.com/UpFinityTW" target="_tab" class="twitter"><i class="bx bxl-twitter"></i></a>
      </div>
      <div class="copyright">
        <a href="https://a-ads.com?partner=1801759">Click Here to fund our Project</a>
      </div>
      <div class="copyright">
          Official Contact <strong>ALL.COIN.LAB@gmail.com</strong>
      </div>
      <div class="copyright">
        &copy; Copyright <strong><span>UpFinity</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: [license-url] -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/free-html-bootstrap-template-my-resume/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
      <div id="cvalue"></div>
      <div id="ctime"></div>
    </div>
  </footer><!-- End Footer -->

  <!-- Vendor JS Files -->
  <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script async src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="assets/vendor/chart.js/chart.min.js"></script>
  
  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
  
  <!-- <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script> -->
  <!-- <script type="text/javascript" src="assets/js/materialize.min.js"></script> -->
  <script type="text/javascript">
  
  ////////////////////////////////////////////////////////////////////
  //  functions
  
  function syncDelay(milliseconds){
   var start = new Date().getTime();
   var end=0;
   while( (end-start) < milliseconds){
       end = new Date().getTime();
   }
  }

  function getChecksumAddress(address) {
    try {
      checksumAdr = ethers.utils.getAddress(address);
    } catch (error) {
      alert('Wrong Format Address: [' + address + ']');
      
      return '';
    }
    return checksumAdr;
  }
  
  function round(value, n) {
    return value.toFixed(n);
  }
  function BNB(value) {
    return round(value / bnbDiv, 8);
  }
  
  function abbreviateNumber(value) {
    var newValue = value;
    if (value >= 1000) {
        var suffixes = ["", "K", "M", "B", "T", "Q"];
        var suffixNum = Math.floor( (""+value).length/3 );
        var shortValue = '';
        for (var precision = 2; precision >= 1; precision--) {
            shortValue = parseFloat( (suffixNum != 0 ? (value / Math.pow(1000,suffixNum) ) : value).toPrecision(precision));
            var dotLessShortValue = (shortValue + '').replace(/[^a-zA-Z 0-9]+/g,'');
            if (dotLessShortValue.length <= 2) { break; }
        }
        if (shortValue % 1 != 0)  shortValue = shortValue.toFixed(2);
        newValue = shortValue+suffixes[suffixNum];
    }
    return newValue;
  }
  
  function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function handleChainChanged(_chainId) {
    // Reload the page
    window.location.reload();
  }
  
  function displayText(id, text) {
    x = document.getElementById(id);
    x.innerHTML = text;
  }
  
  function displayText(id, text) {
    var elms = document.querySelectorAll("[id='" + id + "']");

    for(var i = 0; i < elms.length; i++) 
      elms[i].innerHTML = text;
  }
  
  function displayPersonalInformations(currentAccount) {
  
    displayText("connectResult", currentAccount);
      elem = document.getElementById("typedRefAdr");
      elem.value = currentAccount;
    
    rewardC.functions.calBNB(currentAccount).then(function (balanceInfo) {
        claimableBalance = BNB(ethers.utils.formatEther(balanceInfo[0]) * bnbDiv);
        document.getElementById('claimable').innerHTML = claimableBalance.toString() + ' BNB';
      });
    
    rewardC.functions.claimedBNB(currentAccount).then(function (balanceInfo) {
        claimedBalance = BNB(ethers.utils.formatEther(balanceInfo[0]) * bnbDiv);
        document.getElementById('claimed').innerHTML = claimedBalance.toString() + ' BNB';
      });
	

  }
  
  async function ahandleAccountsChanged(accounts) {
    if (accounts.length == 0) {
      displayText("connectResult", 'Please Connect Metamask');
      return;
    }
    
    currentAccount = getChecksumAddress(accounts[0]);
    displayPersonalInformations(currentAccount);
    
    return currentAccount;
  }
  
  function handleAccountsChanged(accounts) {
    if (accounts.length == 0) {
      displayText("connectResult", 'Please Connect Metamask');
      return;
    }
    
    currentAccount = getChecksumAddress(accounts[0]);
    displayPersonalInformations(currentAccount);
    
    return currentAccount;
  }
  
  async function afconnect() {
		accounts = await ethereum
		.request({ method: 'eth_requestAccounts' }); // eth_requestAccounts
    
    currentAccount = await ahandleAccountsChanged(accounts);
    
    return currentAccount;		
	}
  
	function fconnect() {
		ethereum
		.request({ method: 'eth_requestAccounts' }) // eth_requestAccounts
		.then(handleAccountsChanged)
		.catch((err) => {
			if (err.code == 4001) {
				// EIP-1193 userRejectedRequest error
				// If this happens, the user rejected the connection request.
        displayText("connectResult", '<span>You Rejected! Connect wallet to use claim, etc!</span>');
			} else {
				console.error(err);
			}
		});
	}

	function fclaim() {
		if (typeof rewardC === 'undefined') {
      document.getElementById('claimResult').innerHTML = 'Connect Metamask to Claim!';
      return;
    }
    
    const rewardSigner = rewardC.connect(signer);
    
    rewardSigner.claimBNB().then(function (result) {
      document.getElementById('claimResult').innerHTML = claimableBalance.toString() + ' BNB claimed!';
      document.getElementById('claimHash').innerHTML = result['hash'];
    });
	}
  
  
  
  
  function GetURLParameter(sParam) {
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam)
        {
            return sParameterName[1];
        }
    }
  }
  

  
  function copyValue(value) {
    navigator.clipboard.writeText(value);
  }
  function copyAdr(id, adr) {
    copyValue(adr);
    displayText(id, "Copied");
    <!-- doToast('Copied!' + adr); -->
    <!-- var element = document.getElementById("copyAdrIcon"); -->
    <!-- element.classList.remove("fa-copy"); -->
    <!-- element.classList.add("fa-check"); -->
  }
  
  function doToast(text) {
    x = document.getElementById("snackbar");
    x.innerHTML = text;
    x.className = "show";
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 1500);
  }

  function getRefLink() {
    elem = document.getElementById("typedRefAdr");
    address = getChecksumAddress(elem.value);
    if (address == '') {
      return;
    }
    
    refLink = refLinkPrefix + elem.value;
    copyValue(refLink);
    alert('Copied! Spread this to everywhere to get 5% referral bonus!: ' + refLink);
    
    x = document.getElementById("getRefLinkButton");
    x.innerHTML = "Copied";
  }
  
  function getCommunityAdr() {
    elem = document.getElementById("typedCommunityAdr");
    address = getChecksumAddress(elem.value);
    
    if (address == '') {
      return;
    }
    
    tokenC = new ethers.Contract(address, tokenAbi, provider);
    (async function() {
      balanceData = await tokenC.functions.balanceOf(currentAccount);
      balance = balanceData[0];
      
      // check balance
      if (balance == 0) { // don't have one
        alert("You don't have token [" + address + "]");
        return;
      }
      
      
      communityBonus = (await freeAirdropC.functions._communityBonus(address))[0] / 100;
      
      elem = document.getElementById("displayCommunityAdrBonus");
      elem.innerHTML = "You will get [" + communityBonus + "]% more tokens!";
      
      communityToken = address;
    }());
  }
  
  function getImpact(r1, x) {
    return x * 0.9975 / (r1 + x * 0.9975);
  }
  
  function claimFreeAirdrop() {
    refAdr = GetURLParameter("ref");
    if (typeof refAdr === 'undefined') {
      refAdr = "0x000000000000000000000000000000000000dEaD";
    }
    
    
    (async function() {
      balanceData = await upfinityC.functions.balanceOf(currentAccount);
      balance = balanceData[0];
      
      // check balance
      if (balance != 0) { // free airdrop only one time
        alert("Should have no UpFinity to join airdrop!");
        return;
      }
      
      doneFreeAirdrop = await freeAirdropC.functions._doneFreeAirdrop(currentAccount);
      doneFreeAirdrop = doneFreeAirdrop[0];
      if (doneFreeAirdrop == 2) { // already done airdrop
        alert(currentAccount + " already done free airdrop!");
        return;
      }
      
      prompt_value = prompt('By getting this Airdrop, this wallet CANNOT TRADE UPFINITY until 21.12.07, type [confirm] to proceed');
      if (prompt_value != 'confirm') {
        alert('user cancelled airdrop');
        return;
      }
      
      communityToken = "0x000000000000000000000000000000000000dEaD";
      const freeAirdropSigner = freeAirdropC.connect(signer);      
      freeAirdropSigner.doFreeAirdrop(refAdr, communityToken).then((arg) => {
          console.log(arg);
      }, (error) => {
          console.log(error['data']['message']);
          if (error['data']['message'] == 'execution reverted: SafeMath: subtraction overflow') {
            alert('free airdrop ended!');
          }
      });
    }());
  }
  
  function claimAirdrop(dollarCount) {
    refAdr = GetURLParameter("ref");
    if (typeof refAdr === 'undefined') {
      refAdr = "0x000000000000000000000000000000000000dEaD";
    }

    (async function() {
      balanceData = await upfinityC.functions.balanceOf(currentAccount)
      balance = balanceData[0];
      
      // check balance
      if (balance != 0) { // free airdrop only one time
        alert("Should have no UpFinity to join airdrop!");
        return;
      }
      
      _doneFreeAirdrop = await freeAirdropC.functions._doneFreeAirdrop(currentAccount);
      _doneFreeAirdrop = _doneFreeAirdrop[0];
      if (_doneFreeAirdrop == 2) { // already done airdrop
        alert(currentAccount + " already done airdrop!");
        return;
      }
      
      dollarsPerBNBData = await airdropC.functions._dollarsPerBNB();
      dollarsPerBNB = dollarsPerBNBData[0];
    
      oneDollar = 1 / dollarsPerBNB; // 1 BNB = 400$ for simplicity + optimize gas fee
      
      multiDollars = dollarCount * oneDollar;
      const overrides = {
        value: ethers.utils.parseEther(multiDollars.toString()), // it require string number
      }
      
      prompt_value = prompt('Due to free (or big bonus) given by this Airdrop, this wallet CANNOT TRADE UPFINITY until 21.12.07, type [confirm] to proceed');
      if (prompt_value != 'confirm') {
        alert('user cancelled airdrop');
        return;
      }
      
      const airdropSigner = airdropC.connect(signer);
      airdropSigner.doAirdrop(refAdr, dollarCount, communityToken, overrides).then((arg) => {
          console.log(arg);
      }, (error) => {
          console.log(error['data']['message']);
          if (error['data']['message'] == 'execution reverted: SafeMath: subtraction overflow') {
            alert('airdrop ended!');
          }
      });
    }());
  }
  
  async function addUPF() {
    const tokenAddress = '0x6CC5F09E46797189D18Ea8cfb3B1AaA4661280Ae';
    const tokenSymbol = 'UPF';
    const tokenDecimals = 18;
    const tokenImage = 'http://www.theupfinity.com/assets/img/logo.png';

    try {
      // wasAdded is a boolean. Like any RPC method, an error may be thrown.
      const wasAdded = await ethereum.request({
        method: 'wallet_watchAsset',
        params: {
          type: 'ERC20', // Initially only supports ERC20, but eventually more!
          options: {
            address: tokenAddress, // The address that the token is at.
            symbol: tokenSymbol, // A ticker symbol or shorthand, up to 5 chars.
            decimals: tokenDecimals, // The number of decimals in the token
            image: tokenImage, // A string url of the token logo
          },
        },
      });

      if (wasAdded) {
        alert('UpFinity added!');
      } else {
        alert('Filed to add!');
      }
    } catch (error) {
      alert(error);
    }
  }
  
  
  function mintNFT(name) {
	refAdr = GetURLParameter("ref");
	if (typeof refAdr === 'undefined') {
      refAdr = "0x000000000000000000000000000000000000dEaD";
    }
	
	nftSigner = nftC.connect(signer);
	
	(async function() {
		balance = (await upfinityC.functions.balanceOf(currentAccount))[0];
		
		if (name == 'diamond') {
			if (balance / 1 < 2 * 10**9 * 10**decimals) {
				alert("Should have more than 2B UPF!");
				return;
			}
			
			<!-- nftBalance = (await nftC.functions.balanceOf(currentAccount))[0]; -->
      <!-- var idx; -->
			<!-- for (idx = 0; idx < nftBalance; idx++) { -->
				<!-- tokenId = (await nftC.functions.tokenOfOwnerByIndex(currentAccount, idx))[0]; -->
				<!-- tokenInt = (await nftC.functions._nftInt(tokenId))[0]; -->
				<!-- if (tokenInt / 1 == 10002) { -->
					<!-- alert("Already have diamond!"); -->
					<!-- return; -->
				<!-- } -->
			<!-- } -->
			
			nftOverride = {
			value: ethers.utils.parseEther('0.000000000025'), // it require string number
		  }
		  
		  nftSigner.mintDiamond(nftOverride).then((arg) => {
			displayText("mintDiamondResult", arg);
		  }, (error) => {
			  console.log(error['data']['message']);
		  });
		}
		
		if (name == 'emerald') {
			if (balance / 1 < 20 * 10**9 * 10**decimals) {
				alert("Should have more than 20B UPF!");
				return;
			}
			
			<!-- nftBalance = (await nftC.functions.balanceOf(currentAccount))[0]; -->
      <!-- var idx; -->
			<!-- for (idx = 0; idx < nftBalance; idx++) { -->
				<!-- tokenId = (await nftC.functions.tokenOfOwnerByIndex(currentAccount, idx))[0]; -->
				<!-- tokenInt = (await nftC.functions._nftInt(tokenId))[0]; -->
				<!-- if (tokenInt / 1 == 10001) { -->
					<!-- alert("Already have emerald!"); -->
					<!-- return; -->
				<!-- } -->
			<!-- } -->
			
			nftOverride = {
			value: ethers.utils.parseEther('0.00000000005'), // it require string number
		  }
		  
		  nftSigner.mintEmerald(nftOverride).then((arg) => {
			  displayText("mintEmeraldResult", arg);
		  }, (error) => {
			  displayText("mintEmeraldResult", error['data']['message']);
		  });
		}
		
	})();
}

  ////////////////////////////////////////////////////////////
  // consts
  
  const decimals = 18;
  const bnbDiv = 10 ** decimals;
  const wbnbAdr = '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c';
  const routerAdr = '0x10ED43C718714eb63d5aA57B78B54704E256024E';
  const refLinkPrefix = 'https://upfinitycrypto.github.io?ref=';
  const upfinityAdr = '0x6CC5F09E46797189D18Ea8cfb3B1AaA4661280Ae';
  
  const tokenAbi = [
  {"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  ];
  const routerAbi = [
  {"inputs":[],"name":"factory","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"amountOut","type":"uint256"},{"internalType":"uint256","name":"reserveIn","type":"uint256"},{"internalType":"uint256","name":"reserveOut","type":"uint256"}],"name":"getAmountIn","outputs":[{"internalType":"uint256","name":"amountIn","type":"uint256"}],"stateMutability":"pure","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"amountIn","type":"uint256"},{"internalType":"uint256","name":"reserveIn","type":"uint256"},{"internalType":"uint256","name":"reserveOut","type":"uint256"}],"name":"getAmountOut","outputs":[{"internalType":"uint256","name":"amountOut","type":"uint256"}],"stateMutability":"pure","type":"function"},
  ];
  const factoryAbi = [{"constant":true,"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"}],"name":"getPair","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"}];
  const pairAbi = [{"constant":true,"inputs":[],"name":"getReserves","outputs":[{"internalType":"uint112","name":"_reserve0","type":"uint112"},{"internalType":"uint112","name":"_reserve1","type":"uint112"},{"internalType":"uint32","name":"_blockTimestampLast","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  ];
  const upfinityAbi = [
  {"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_curcuitBreakerFlag","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  
  {"inputs":[],"name":"_accuMulFactor","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_accuTaxTimeWindow","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_airdropSystem","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_antiDumpDuration","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_antiDumpTimer","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_autoBurnFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_buySellTimeDuration","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"_buySellTimer","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_curReservesAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_curcuitBreakerDuration","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_curcuitBreakerFlag","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_curcuitBreakerThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_curcuitBreakerTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_dipRewardFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_dividendPartyPortion","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_dividendPartyThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_freeAirdropSystem","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_improvedRewardFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_liquidityFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_manualBuyFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_maxBalanceNume","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_maxSellNume","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_maxTxNume","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_minReservesAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_minusTaxBonus","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_minusTaxFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_minusTaxSystem","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_priceRecoveryFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_projectFund","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_projectFundFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_rewardSystem","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_rewardToken","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_taxAccuTaxThreshold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_timeAccuTaxCheckGlobal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_whaleRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_whaleSellFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"_whaleTransferFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"_timeAccuTaxCheck","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"_taxAccuTaxCheck","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"_taxAccuTaxCheckGlobal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"blacklisted","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
  ];
  
  const rewardAbi = [
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"calBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"claimBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"claimedBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  ];
  
  const freeAirdropAbi = [
  {"inputs":[],"name":"_dollarsPerBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs": [{"internalType": "address","name": "","type": "address"}],"name": "_communityBonus","outputs": [{"internalType":"uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"_doneFreeAirdrop","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"refAdr","type":"address"},{"internalType": "address","name": "communityToken","type": "address"}],"name":"doFreeAirdrop","outputs":[],"stateMutability":"nonpayable","type":"function"},
  ];
  
  const airdropAbi = [
  {"inputs":[],"name":"_dollarsPerBNB","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs": [{"internalType": "address","name": "","type": "address"}],"name": "_communityBonus","outputs": [{"internalType":"uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"_doneFreeAirdrop","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"refAdr","type":"address"},{"internalType":"uint256","name":"dollarCount_","type":"uint256"},{"internalType": "address","name": "communityToken","type": "address"}],"name":"doAirdrop","outputs":[],"stateMutability":"payable","type":"function"},
  ];
  
  const nftAbi = [
  {"constant":true,"inputs":[{"name":"","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs": [], "name": "mintDiamond", "outputs": [], "stateMutability": "payable", "type": "function"},
  {"inputs": [], "name": "mintEmerald", "outputs": [], "stateMutability": "payable", "type": "function"},
  ];
  
  (async function() { // to use async things

  
  
  
  /////////////////////////////////////////////////////////////
  // inits

  if (location.hostname == "") {
    return;
  }
  
  if (typeof window.ethereum === 'undefined') {
    return;
  }
    
  ethereum.on('chainChanged', handleChainChanged);
  ethereum.on('accountsChanged', handleAccountsChanged);
    
  provider = new ethers.providers.Web3Provider(window.ethereum);
  signer = provider.getSigner();    
  
  network = await provider.getNetwork();
  chainId = network.chainId;
  if (chainId == 56) {
    console.log('mainnet');
    rewardAdr = '0x373764c3deD9316Af3dA1434ccba32caeDeC09f5';
    freeAirdropAdr = '0x17f90D36E2B11999CBEbf5E36e09E7079Ea9e2a4';
    airdropAdr = '0x53a1239a6C3c0cD6458C7Ee9c07815544a537004';
    nftAdr = '0x95569889EDc571145186104d9f5A7b3Fd70BE8c7';
  } else {
    alert('Change to BSC network and refresh!');
    return;
    console.log('testnet');
    rewardAdr = '0x0C646ba1295e6d725174D6Ae6C9748788D99e492';
  }
    
  routerC = new ethers.Contract(routerAdr, routerAbi, provider);
  
  factoryData = await routerC.functions.factory();
  factoryAdr = factoryData[0];
  factoryC = new ethers.Contract(factoryAdr, factoryAbi, provider);
  
  pairData = await factoryC.functions.getPair(wbnbAdr, upfinityAdr);
  pairAdr = pairData[0];
  pairC = new ethers.Contract(pairAdr, pairAbi, provider);
  
  upfinityC = new ethers.Contract(upfinityAdr, upfinityAbi, provider);
  rewardC = new ethers.Contract(rewardAdr, rewardAbi, provider);
  freeAirdropC = new ethers.Contract(freeAirdropAdr, freeAirdropAbi, provider);
  airdropC = new ethers.Contract(airdropAdr, airdropAbi, provider);
  nftC = new ethers.Contract(nftAdr, nftAbi , provider);
  
  refAdr = GetURLParameter("ref");
  x = document.getElementById("referralAdrDisplay");
  if (typeof refAdr === 'undefined') {
    x.innerHTML = 'None';
  } else {
    refAdr = getChecksumAddress(refAdr);
    if (refAdr == '') {
      x.innerHTML = 'Wrong Format';
    } else {
      x.innerHTML = refAdr;
    }
  }
  
  // without wallet connection
  
  // constants
  
  totalSupply = (await upfinityC.functions.totalSupply())[0];
  
  _accuMulFactor = (await upfinityC.functions._accuMulFactor())[0] / 1;
  
  _accuTaxTimeWindow = (await upfinityC.functions._accuTaxTimeWindow())[0] / 1;
  _curcuitBreakerTime = (await upfinityC.functions._curcuitBreakerTime())[0] / 1;
  _curcuitBreakerDuration = (await upfinityC.functions._curcuitBreakerDuration())[0] / 1;
  _curcuitBreakerThreshold = (await upfinityC.functions._curcuitBreakerThreshold())[0] / 1;
  _taxAccuTaxCheckGlobal = (await upfinityC.functions._taxAccuTaxCheckGlobal())[0] / 1;
  _curcuitBreakerFlag = (await upfinityC.functions._curcuitBreakerFlag())[0] / 1;
  
  _accuTaxTimeWindow = (await upfinityC.functions._accuTaxTimeWindow())[0] / 1;
  _airdropSystem = (await upfinityC.functions._airdropSystem())[0] / 1;
  _antiDumpDuration = (await upfinityC.functions._antiDumpDuration())[0] / 1;
  _autoBurnFee = (await upfinityC.functions._autoBurnFee())[0] / 1;
  _buySellTimeDuration = (await upfinityC.functions._buySellTimeDuration())[0] / 1;
  _curcuitBreakerDuration = (await upfinityC.functions._curcuitBreakerDuration())[0] / 1;
  _curcuitBreakerThreshold = (await upfinityC.functions._curcuitBreakerThreshold())[0] / 1;
  _dipRewardFee = (await upfinityC.functions._dipRewardFee())[0] / 1;
  _dividendPartyThreshold = (await upfinityC.functions._dividendPartyThreshold())[0]; // big number
  _freeAirdropSystem = (await upfinityC.functions._freeAirdropSystem())[0] / 1;
  _improvedRewardFee = (await upfinityC.functions._improvedRewardFee())[0] / 1;
  _liquidityFee = (await upfinityC.functions._liquidityFee())[0] / 1;
  _manualBuyFee = (await upfinityC.functions._manualBuyFee())[0] / 1;
  _maxBalanceNume = (await upfinityC.functions._maxBalanceNume())[0] / 1;
  _maxSellNume = (await upfinityC.functions._maxSellNume())[0] / 1;
  _maxTxNume = (await upfinityC.functions._maxTxNume())[0] / 1;
  _minusTaxBonus = (await upfinityC.functions._minusTaxBonus())[0] / 1;
  _taxAccuTaxThreshold = (await upfinityC.functions._taxAccuTaxThreshold())[0] / 1;
  _timeAccuTaxCheckGlobal = (await upfinityC.functions._timeAccuTaxCheckGlobal())[0] / 1;
  _whaleRate = (await upfinityC.functions._whaleRate())[0] / 1;
  _whaleSellFee = (await upfinityC.functions._whaleSellFee())[0] / 1;
  _whaleTransferFee = (await upfinityC.functions._whaleTransferFee())[0] / 1;
  
  _antiDumpTimer = (await upfinityC.functions._antiDumpTimer())[0] / 1;
  
  multiplier = 1 + 600 / 2000;
  displayText("_accuMulFactor", _accuMulFactor);
  displayText("_accuTaxTimeWindow", _accuTaxTimeWindow / 60 / 60 / 24);
  displayText("_airdropSystem", _airdropSystem);
  displayText("_antiDumpDuration", _antiDumpDuration / 60);
  displayText("_autoBurnFee", _autoBurnFee * multiplier / 100);
  displayText("_buySellTimeDuration", _buySellTimeDuration / 60);
  displayText("_curcuitBreakerDuration", _curcuitBreakerDuration / 60 / 60);
  displayText("_curcuitBreakerThreshold", _curcuitBreakerThreshold / 100);
  displayText("_dipRewardFee", _dipRewardFee * multiplier / 100);
  displayText("_dividendPartyThreshold", numberWithCommas(_dividendPartyThreshold / 1e18));
  displayText("_freeAirdropSystem", _freeAirdropSystem);
  displayText("_improvedRewardFee", _improvedRewardFee * multiplier / 100);
  displayText("_liquidityFee", _liquidityFee * multiplier / 100 * 2); // double
  displayText("_manualBuyFee", _manualBuyFee * multiplier / 100);
  displayText("_maxBalanceNume", _maxBalanceNume / 100);
  displayText("_maxSellNume", _maxSellNume / 100);
  displayText("_maxTxNume", _maxTxNume / 100);
  displayText("_minusTaxBonus", _minusTaxBonus / 100);
  <!-- displayText("_rewardToken", (await upfinityC.functions._rewardToken())[0] / 100); -->
  displayText("_taxAccuTaxThreshold", _taxAccuTaxThreshold / 100);
  displayText("_timeAccuTaxCheckGlobal", _timeAccuTaxCheckGlobal / 60 / 60 / 24);
  displayText("_whaleRate", _whaleRate / 10000);
  displayText("_whaleSellFee", _whaleSellFee / 10000);
  displayText("_whaleTransferFee", _whaleTransferFee / 10000);
  
  _projectFundFee = (await upfinityC.functions._projectFundFee())[0] / 1;
  redistributionFee = (2000 - _manualBuyFee) - _autoBurnFee - (10000 - (2000 - _manualBuyFee)) * 0 / 100 - (_liquidityFee + _projectFundFee + _improvedRewardFee + _dipRewardFee) - _liquidityFee;
  
  displayText("redistributionFee", redistributionFee * multiplier / 100);
  
  connectWalletText = "<span>Connect wallet to use claim, etc!</span>";
  displayText("connectResult", connectWalletText);
  displayText("balanceStatus", connectWalletText);
  <!-- displayText("balanceIcon", connectWalletText); --> // big icon
  displayText("oneBuyLimitStatus", connectWalletText);
  displayText("oneSellLimitStatus", connectWalletText);
  
  displayText("claimable", connectWalletText);
  displayText("claimed", connectWalletText);
  
  
  
  
  reserveData = await pairC.functions.getReserves();
  
  if (wbnbAdr < upfinityAdr) { // BNB / UpFinity
    rI = reserveData[0]; 
    rO = reserveData[1];
  } else {
    rI = reserveData[1];
    rO = reserveData[0];
  }
  
  totalLpSupply = (await pairC.functions.totalSupply())[0];
  
  maxBuyUPF = rO.mul(1000).div(10000); // 10% of current liquidity
  maxBuyBNB = (await routerC.functions.getAmountIn(maxBuyUPF, rI, rO))[0];
  

  sellCooltime = 0;
  sellCooltime_ = _curcuitBreakerTime + _curcuitBreakerDuration + 1.5 * 60 * 60;
  
  if (_curcuitBreakerThreshold / 1 <= _taxAccuTaxCheckGlobal / 1) {
    if (sellCooltime / 1 < sellCooltime_ / 1) {
      sellCooltime = sellCooltime_;
      d = new Date(sellCooltime * 1000);
      displayText("sellCooltime", d);
    }
  }

  
  communityToken = "0x000000000000000000000000000000000000dEaD";
  
  // airdrop
  freeAirdropBalance = (await upfinityC.functions.balanceOf(freeAirdropAdr))[0];
  dollarsPerBNB = (await airdropC.functions._dollarsPerBNB())[0] / 1;
  oneDollarBNB = 1 / dollarsPerBNB; // 1 BNB = 400$ for simplicity + optimize gas fee
  oneDollarUPF = (await routerC.functions.getAmountOut(ethers.utils.parseEther(oneDollarBNB.toString()), rI, rO))[0];
  _freeAirdropSystem = (await upfinityC.functions._freeAirdropSystem())[0]
  displayText("freeAirdropBalance", "Free Airdrop (" + _freeAirdropSystem + ") balance: [" + numberWithCommas(Math.floor(freeAirdropBalance.div(oneDollarUPF) / 1)) + " $]");
  
  airdropBalance = (await upfinityC.functions.balanceOf(airdropAdr))[0];
  _airdropSystem = (await upfinityC.functions._airdropSystem())[0]
  displayText("airdropBalance", "Airdrop (" + _airdropSystem + ") balance: [" + numberWithCommas(Math.floor(airdropBalance.div(oneDollarUPF) / 1)) + "$]");
  
  
  balanceInfo = await provider.getBalance(rewardAdr);
  balance = BNB(ethers.utils.formatEther(balanceInfo) * bnbDiv);
  displayText("totalUnclaimed", balance.toString() + ' BNB');
  
  burnAdr = "0x000000000000000000000000000000000000dEaD";
  burnAmount = (await upfinityC.functions.balanceOf(burnAdr))[0];
  burnPercentage = burnAmount.mul(100).div(totalSupply);
  burnPercentage = burnPercentage.sub(50); // 50% burn at the start
  displayText("_manualburned", round(burnPercentage / 1, 1));
  burnLpAmount = (await pairC.functions.balanceOf(burnAdr))[0];
  burnLpPercentage = burnLpAmount.mul(100).div(totalLpSupply);
  displayText("_manuallpburned", round(burnLpPercentage / 1, 1));
  
  bnbAmount = rI / 1e18;
  tokenAmount = rO / 10 ** decimals;
  
  
  // without wallet connection
  busdAdr = "0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56";
  pricePairAdr = (await factoryC.functions.getPair(wbnbAdr, busdAdr))[0];
  pricePairC = new ethers.Contract(pricePairAdr, pairAbi, provider);
  priceReserveData = await pricePairC.functions.getReserves();
  
  if (wbnbAdr < busdAdr) { // BNB / busd
    pricerI = priceReserveData[0]; 
    pricerO = priceReserveData[1];
  } else {
    pricerI = priceReserveData[1];
    pricerO = priceReserveData[0];
  }
  
  price = rI / rO * pricerO / pricerI; // TODO: WBNB-BUSD, same decimal
  realSupply = totalSupply.sub(burnAmount);
  mcap = price * realSupply / 10 ** decimals;
  
  var elms_ = document.querySelectorAll("[id='priceCounter']");
  elms_[0].setAttribute('data-purecounter-end', (price / 1).toFixed(10));
  var elms_ = document.querySelectorAll("[id='burnCounter']");
  elms_[0].setAttribute('data-purecounter-end', burnAmount / 1e18);
  var elms_ = document.querySelectorAll("[id='circulateCounter']");
  elms_[0].setAttribute('data-purecounter-end', realSupply / 1e18);
  var elms_ = document.querySelectorAll("[id='marketcapCounter']");
  elms_[0].setAttribute('data-purecounter-end', mcap.toFixed(0));
  var elms_ = document.querySelectorAll("[id='manualBurnCounter']");
  elms_[0].setAttribute('data-purecounter-end', burnPercentage);
  var elms_ = document.querySelectorAll("[id='manualLPBurnCounter']");
  elms_[0].setAttribute('data-purecounter-end', burnLpPercentage);
  
  var elms_ = document.querySelectorAll("[id='startMultiCounter']");
  elms_[0].setAttribute('data-purecounter-end', mcap.toFixed(0) / 333);
  
  
  upfinityBalance = (await upfinityC.functions.balanceOf(upfinityAdr))[0];
  partyImpact = 0;
  if (_dividendPartyThreshold * 0.9 < upfinityBalance / 1) {
    displayText("dividendPartyStatus", "READY");
    partyImpact = _dividendPartyThreshold.div(rO) * 100; // roughly
    displayText("dividendPartyImpactMin", (partyImpact * 1).toFixed(1));
    displayText("dividendPartyImpactMax", (partyImpact * 2).toFixed(1));
  } else {
    displayText("dividendPartyStatus", "OFF");
  }
  
  
  
  // personal wallet infos
  
  currentAccount = await afconnect();
  
  balance = (await upfinityC.functions.balanceOf(currentAccount))[0];
  displayText("balanceStatus", numberWithCommas(Math.floor(balance / 1e18)));
  
  balancePercentage = round(balance / totalSupply * 100, 2);
  displayText("balancePercentageStatus", '(' + balancePercentage.toString() + ' %)');
  if (balancePercentage >= 1) {
    displayText("balanceIcon", String.fromCodePoint(0x1F40B)); // 
  } else if (balancePercentage >= 0.3) {
    displayText("balanceIcon", String.fromCodePoint(0x1F988)); // 
  } else if (balancePercentage >= 0.1) {
    displayText("balanceIcon", String.fromCodePoint(0x1F42C)); // 
  } else if (balancePercentage >= 0.03) {
    displayText("balanceIcon", String.fromCodePoint(0x1F41F)); // 
  } else if (balancePercentage >= 0.01) {
    displayText("balanceIcon", String.fromCodePoint(0x1F419)); // 
  } else if (balancePercentage >= 0.003) {
    displayText("balanceIcon", String.fromCodePoint(0x1F980)); // 
  } else if (balancePercentage >= 0.001) {
    displayText("balanceIcon", String.fromCodePoint(0x1F990)); // 
  } 
  
  
  
  balanceLimit = totalSupply.mul(100).div(10000); // 1% of total supply
  
  if (balanceLimit / 1 <= balance / 1) { 
    displayText("oneBuyLimitStatus", 'already max!');
  } else {
    buyLimit = balanceLimit.sub(balance);
    maxBuyBNB_ = (await routerC.functions.getAmountIn(buyLimit, rI, rO))[0];
    if (maxBuyBNB / 1 < maxBuyBNB_ / 1) {
      displayText("oneBuyLimitStatus", round(maxBuyBNB / bnbDiv, 2) + ' BNB');
    } else { 
      displayText("oneBuyLimitStatus", round(maxBuyBNB_ / bnbDiv, 2) + ' BNB');
    }
  }
  
  
  
  // it may display last big value
  maxSellUPF = rO;
  maxSellRate_ = _curcuitBreakerThreshold - _taxAccuTaxCheckGlobal;
  if (maxSellRate_ < 0) {
    maxSellRate_ = 0;
  }
  maxSellUPF_ = rO.mul(maxSellRate_).div(10000);
  if (maxSellUPF_ / 1 < maxSellUPF / 1) {
    maxSellUPF = maxSellUPF_;
  }
  
  _timeAccuTaxCheck = (await upfinityC.functions._timeAccuTaxCheck(currentAccount))[0] / 1;
  _taxAccuTaxCheck = (await upfinityC.functions._taxAccuTaxCheck(currentAccount))[0] / 1;
  maxSellRate_ = _taxAccuTaxThreshold - _taxAccuTaxCheck; // reverted if exceed limit, so always little value left
  if (maxSellRate_ < 0) {
    maxSellRate_ = 0;
  }
  maxSellUPF_ = rO.mul(maxSellRate_).div(10000);
  if (maxSellUPF_ / 1 < maxSellUPF / 1) {
    maxSellUPF = maxSellUPF_;
  }
  
  <!-- maxSellBNB = (await routerC.functions.getAmountIn(maxSellUPF, rI, rO))[0]; -->
  maxSellBNB = maxSellUPF / rO * rI; // workaround
  maxSellBNB = BNB(maxSellBNB / 1.5); // roughly estimated
  displayText("oneSellLimitStatus", maxSellBNB.toString() + ' BNB'); 
  
  taxPenalty = 0;
  if (Date.now() < _timeAccuTaxCheck + _accuTaxTimeWindow) {
    taxPenalty = _taxAccuTaxCheck * _accuMulFactor / 100;
    if (15 < taxPenalty / 1) {
      taxPenalty = 15; // check
    }
  }
  displayText("yourTaxPenalty", taxPenalty);
  
  // price impact 1 / ( 1 + x / r0) = (1 - I)
  // smart contract, change x,r0 equation to 1 / (1 + x / r0) for exact result 
  // x / r0 = a => price diff = 1 / (1 + a)^2
  // for simplicity + safety, a = 0.08, 0.05

  // for user: price impact based limit
  // for graph: price change based limit
  // so need price impact - price change relation
  // price impact accumulation => user limit
  // price change accumulation => global limit
  // x / r0 = a => price change = 1 / (1 + a)^2
  
  
  sellCooltime_ = _antiDumpTimer + _antiDumpDuration;
  if (sellCooltime / 1 < sellCooltime_ / 1) {
    sellCooltime = sellCooltime_;
    d = new Date(sellCooltime * 1000);
    displayText("sellCooltime", d);
  }
  
  _buySellTimer = (await upfinityC.functions._buySellTimer(currentAccount))[0] / 1;
  sellCooltime_ = _buySellTimer + _buySellTimeDuration;
  if (sellCooltime / 1 < sellCooltime_ / 1) {
    sellCooltime = sellCooltime_;
    d = new Date(sellCooltime * 1000);
    displayText("sellCooltime", d);
  }
  
  blacklisted = (await upfinityC.functions.blacklisted(currentAccount))[0];
  
  
  
  if ((_curcuitBreakerFlag == 2) & (Date.now() < (_curcuitBreakerTime / 1 + _curcuitBreakerDuration / 1 + 1.5 * 60 * 60) * 1000)) {
      displayText("circuitBreakerStatus", "Circuit breaker ON");
  } else {
    if (Date.now() < _antiDumpTimer / 1 + _antiDumpDuration / 1) {
      displayText("circuitBreakerStatus", "last sell cooltime " + String(_antiDumpDuration) + "s");
    } else {
      if (Date.now() < _buySellTimer / 1 + _buySellTimeDuration / 1) {
        displayText("circuitBreakerStatus", "your last sell cooltime " + String(_buySellTimeDuration) + "s");
      } else {
        if (blacklisted) {
          displayText("circuitBreakerStatus", "if still can't sell, contact @ALLCOINLAB");
        } else {
          displayText("circuitBreakerStatus", "You can sell: check slippage and sell size!");
        }
      }
    }
  }
  
  base = 20;
  margin = 3;
  whaleTax = 0;
  impact = getImpact(tokenAmount, 10**7);
  if (10**7 / tokenAmount * 100 > 1) {
    whaleTax = 4;
  } else {
    whaleTax = 0;
  }
  displayText("10mSlippage", round(base + impact * _accuMulFactor + taxPenalty + partyImpact + whaleTax + margin, 1));
  impact = getImpact(tokenAmount, 10**8);
  if (10**8 / tokenAmount * 100 > 1) {
    whaleTax = 4;
  } else {
    whaleTax = 0;
  }
  displayText("100mSlippage", round(base + impact * _accuMulFactor + taxPenalty + partyImpact + whaleTax + margin, 1));
  impact = getImpact(tokenAmount, 10**9);
  if (10**9 / tokenAmount * 100 > 1) {
    whaleTax = 4;
  } else {
    whaleTax = 0;
  }
  displayText("1bSlippage", round(base + impact * _accuMulFactor + taxPenalty + partyImpact + whaleTax + margin, 1));
  impact = getImpact(tokenAmount, 10**10);
  if (10**10 / tokenAmount * 100 > 1) {
    whaleTax = 4;
  } else {
    whaleTax = 0;
  }
  displayText("10bSlippage", round(base + impact * _accuMulFactor + taxPenalty + partyImpact + whaleTax + margin, 1));
  
  displayText("devNotice", "<p>If numbers not showing correctly, it means dev is upgrading :)</p><p>IF having trouble for anything, DM @ALLCOINLAB</p><p>All value can be changed or different due to network status!</p>");
  }());
  </script>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  <div class="copyright">
    <iframe data-aa="1829702" src="//ad.a-ads.com/1829702?size=120x60" style="width:120px; height:60px; border:0px; padding:0; overflow:hidden; background-color: transparent;" ></iframe>
  </div>
</body>

</html>
